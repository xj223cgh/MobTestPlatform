/* empty css                  */import{v as e}from"./el-loading-89207824.js";import{E as a}from"./el-overlay-6e33dceb.js";import{E as l,a as r}from"./el-radio-group-e12b1858.js";import{E as t,a as s,b as o}from"./el-table-column-fbece626.js";import{E as n}from"./el-tag-611fc351.js";import{a as d,E as u}from"./el-select-9396c850.js";import"./el-scrollbar-68fecf97.js";import{E as i,a as p}from"./el-input-320f57dc.js";import"./el-checkbox-b9bd0a97.js";import"./el-tooltip-4ed993c7.js";import{r as m,b as c,o as g,c as _,d as f,e as v,f as h,w as b,a5 as w,J as y,n as V,l as j,h as k,aB as x,j as C,i as U,aC as z,aD as q,L as E,aq as $,ao as B,E as D,k as I}from"./index-ea26c5b6.js";import{g as T,d as Y,t as A,a as H,c as K}from"./user-e232a6b8.js";import{d as M}from"./dayjs.min-075d2e4a.js";import{_ as O}from"./_plugin-vue_export-helper-1b428a4d.js";import"./refs-9112775b.js";import"./omit-2fc30497.js";import"./castArray-7303869c.js";import"./strings-836bc6fd.js";import"./raf-45c3df72.js";const F={class:"user-management"},P={class:"page-header"},J={class:"header-actions"},L={class:"search-section"},R={class:"table-section"},S={key:1},X={key:1},G={class:"operation-buttons"},N={class:"fixed-pagination"},Q={class:"dialog-footer"},W=O({__name:"UserManagement",setup(O){const W=m(!1),Z=m(!1),ee=m(!1),ae=m(!1),le=m(""),re=m(),te=c({username:"",phone:"",role:"",status:""}),se=c({id:null,username:"",real_name:"",phone:"",password:"",role:"",is_active:!0,gender:"other",department:""}),oe={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],is_active:[{required:!0,message:"请选择状态",trigger:"change"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],department:[{max:100,message:"部门名称不能超过100个字符",trigger:"blur"}]},ne=m([]),de=c({page:1,size:10,total:0}),ue=async()=>{try{W.value=!0;const e={page:de.page,size:de.size};let a="";te.username?a=te.username:te.phone&&(a=te.phone),a&&(e.search=a),te.role&&(e.role=te.role),"true"!==te.status&&"false"!==te.status||(e.is_active="true"===te.status),console.log("API请求参数:",e);const l=await T(e);ne.value=l.data.users||[],de.total=l.data.pagination.total||0}catch(e){V.error("获取用户列表失败"),console.error("获取用户列表错误:",e)}finally{W.value=!1}},ie=()=>{de.page=1,ue()},pe=()=>{Object.assign(te,{username:"",phone:"",role:"",status:""}),ie()},me=()=>{ae.value=!1,le.value="新增用户",ee.value=!0,ge()},ce=async()=>{if(re.value){await re.value.validate(),Z.value=!0;try{const e={username:se.username,real_name:se.real_name,phone:se.phone,role:se.role,is_active:se.is_active,gender:se.gender,department:se.department};let a;!ae.value&&se.password&&(e.password=se.password),a=ae.value?await H(se.id,e):await K(e),a.success?(V.success(ae.value?"编辑成功":"创建成功"),ee.value=!1,ue()):V.error(a.message||(ae.value?"编辑失败":"创建失败"))}catch(e){V.error("操作失败")}finally{Z.value=!1}}},ge=()=>{Object.assign(se,{id:null,username:"",real_name:"",phone:"",password:"",role:"",is_active:!0,gender:"other",department:""}),re.value&&re.value.resetFields()},_e=e=>{de.size=e,de.page=1,ue()},fe=e=>{de.page=e,ue()},ve=e=>({super:"超级管理员",admin:"实习生",manager:"管理员",tester:"测试人员"}[e]||e);return g(()=>{ue()}),(m,c)=>{const g=D,T=j,H=I,K=p,O=d,ge=u,he=i,be=o,we=n,ye=t,Ve=s,je=l,ke=r,xe=a,Ce=e;return _(),f("div",F,[v("div",P,[c[15]||(c[15]=v("div",{class:"header-content"},[v("h1",null,"用户管理"),v("p",{class:"description"},"管理系统用户账号与权限")],-1)),v("div",J,[h(T,{type:"primary",onClick:me},{default:b(()=>[h(g,null,{default:b(()=>[h(k(x))]),_:1}),c[14]||(c[14]=C(" 新增用户 ",-1))]),_:1})])]),v("div",L,[h(he,{model:te,inline:""},{default:b(()=>[h(K,{label:"用户名/姓名"},{default:b(()=>[h(H,{modelValue:te.username,"onUpdate:modelValue":c[0]||(c[0]=e=>te.username=e),placeholder:"请输入用户名/姓名",clearable:"",onClear:ie,onKeyup:U(ie,["enter"]),style:{width:"150px"}},null,8,["modelValue"])]),_:1}),h(K,{label:"手机号"},{default:b(()=>[h(H,{modelValue:te.phone,"onUpdate:modelValue":c[1]||(c[1]=e=>te.phone=e),placeholder:"请输入手机号",clearable:"",onClear:ie,onKeyup:U(ie,["enter"]),style:{width:"150px"}},null,8,["modelValue"])]),_:1}),h(K,{label:"角色"},{default:b(()=>[h(ge,{modelValue:te.role,"onUpdate:modelValue":c[2]||(c[2]=e=>te.role=e),placeholder:"全部角色",clearable:"",onClear:ie,style:{width:"120px"}},{default:b(()=>[h(O,{label:"超级管理员",value:"super"}),h(O,{label:"管理员",value:"manager"}),h(O,{label:"测试人员",value:"tester"}),h(O,{label:"实习生",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),h(K,{label:"用户状态"},{default:b(()=>[h(ge,{modelValue:te.status,"onUpdate:modelValue":c[3]||(c[3]=e=>te.status=e),placeholder:"全部状态",clearable:"",onClear:ie,style:{width:"120px"}},{default:b(()=>[h(O,{label:"启用",value:"true"}),h(O,{label:"禁用",value:"false"})]),_:1},8,["modelValue"])]),_:1}),h(K,null,{default:b(()=>[h(T,{type:"primary",onClick:ie},{default:b(()=>[h(g,null,{default:b(()=>[h(k(z))]),_:1}),c[16]||(c[16]=C(" 搜索 ",-1))]),_:1}),h(T,{onClick:pe},{default:b(()=>[h(g,null,{default:b(()=>[h(k(q))]),_:1}),c[17]||(c[17]=C(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),v("div",R,[w((_(),y(ye,{data:ne.value,stripe:"",border:"",style:{width:"100%"},fit:""},{default:b(()=>[h(be,{prop:"id",label:"ID","min-width":"60",align:"center"},{default:b(({row:e})=>[C(E(e.id||"-"),1)]),_:1}),h(be,{prop:"username",label:"用户名","min-width":"110",align:"center"},{default:b(({row:e})=>[C(E(e.username||"-"),1)]),_:1}),h(be,{prop:"real_name",label:"真实姓名","min-width":"100",align:"center"},{default:b(({row:e})=>[C(E(e.real_name||"-"),1)]),_:1}),h(be,{prop:"phone",label:"手机号","min-width":"130",align:"center"},{default:b(({row:e})=>[C(E(e.phone||"-"),1)]),_:1}),h(be,{prop:"department",label:"部门","min-width":"110",align:"center"},{default:b(({row:e})=>[C(E(e.department||"-"),1)]),_:1}),h(be,{prop:"role",label:"角色","min-width":"90",align:"center"},{default:b(({row:e})=>{return[e.role?(_(),y(we,{key:0,type:(a=e.role,{super:"danger",admin:"info",manager:"warning",tester:"success"}[a]||"info")},{default:b(()=>[C(E(ve(e.role)),1)]),_:2},1032,["type"])):(_(),f("span",S,"-"))];var a}),_:1}),h(be,{prop:"is_active",label:"状态","min-width":"70",align:"center"},{default:b(({row:e})=>[void 0!==e.is_active?(_(),y(we,{key:0,type:e.is_active?"success":"danger"},{default:b(()=>[C(E(e.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])):(_(),f("span",X,"-"))]),_:1}),h(be,{prop:"created_at",label:"创建时间","min-width":"140",align:"center"},{default:b(({row:e})=>{return[C(E((a=e.created_at,a?M(a).format("YYYY-MM-DD HH:mm:ss"):"-")),1)];var a}),_:1}),h(be,{label:"操作","min-width":"180",fixed:"right",align:"center"},{default:b(({row:e})=>[v("div",G,[h(T,{type:"primary",size:"small",onClick:a=>(e=>{ae.value=!0,le.value="编辑用户",ee.value=!0,Object.assign(se,{id:e.id,username:e.username,real_name:e.real_name,phone:e.phone,password:"",role:e.role,is_active:e.is_active,gender:e.gender||"other",department:e.department||""})})(e)},{default:b(()=>[...c[18]||(c[18]=[C(" 编辑 ",-1)])]),_:1},8,["onClick"]),h(T,{type:e.is_active?"warning":"success",size:"small",onClick:a=>(e=>{const a=e.is_active?"禁用":"启用";B.confirm(`确定要${a}用户 "${e.username}" 吗？`,`确认${a}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await A(e.id),V.success(`${a}成功`),ue()}catch(l){V.error(`${a}失败`)}})})(e)},{default:b(()=>[C(E(e.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),h(T,{type:"danger",size:"small",onClick:a=>(e=>{B.confirm(`确定要删除用户 "${e.username}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await Y(e.id);a.success?(V.success("删除成功"),ue()):V.error(a.message||"删除失败")}catch(a){V.error("删除失败")}})})(e)},{default:b(()=>[...c[19]||(c[19]=[C(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[Ce,W.value]])]),v("div",N,[h(Ve,{"current-page":de.page,"page-size":de.size,total:de.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_e,onCurrentChange:fe},null,8,["current-page","page-size","total"])]),h(xe,{modelValue:ee.value,"onUpdate:modelValue":c[13]||(c[13]=e=>ee.value=e),title:le.value,width:"600px","close-on-click-modal":!1},{footer:b(()=>[v("span",Q,[h(T,{onClick:c[12]||(c[12]=e=>ee.value=!1)},{default:b(()=>[...c[22]||(c[22]=[C("取消",-1)])]),_:1}),h(T,{type:"primary",loading:Z.value,onClick:ce},{default:b(()=>[...c[23]||(c[23]=[C(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:b(()=>[h(he,{ref_key:"userFormRef",ref:re,model:se,rules:oe,"label-width":"80px"},{default:b(()=>[h(K,{label:"用户名",prop:"username"},{default:b(()=>[h(H,{modelValue:se.username,"onUpdate:modelValue":c[4]||(c[4]=e=>se.username=e),placeholder:"请输入用户名",disabled:ae.value},null,8,["modelValue","disabled"])]),_:1}),h(K,{label:"真实姓名",prop:"real_name"},{default:b(()=>[h(H,{modelValue:se.real_name,"onUpdate:modelValue":c[5]||(c[5]=e=>se.real_name=e),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),h(K,{label:"手机号",prop:"phone"},{default:b(()=>[h(H,{modelValue:se.phone,"onUpdate:modelValue":c[6]||(c[6]=e=>se.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),ae.value?$("",!0):(_(),y(K,{key:0,label:"密码",prop:"password"},{default:b(()=>[h(H,{modelValue:se.password,"onUpdate:modelValue":c[7]||(c[7]=e=>se.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),h(K,{label:"角色",prop:"role"},{default:b(()=>[h(ge,{modelValue:se.role,"onUpdate:modelValue":c[8]||(c[8]=e=>se.role=e),placeholder:"请选择角色",style:{width:"100%"}},{default:b(()=>[h(O,{label:"超级管理员",value:"super"}),h(O,{label:"管理员",value:"manager"}),h(O,{label:"测试人员",value:"tester"}),h(O,{label:"实习生",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),h(K,{label:"性别",prop:"gender"},{default:b(()=>[h(ge,{modelValue:se.gender,"onUpdate:modelValue":c[9]||(c[9]=e=>se.gender=e),placeholder:"请选择性别",style:{width:"100%"}},{default:b(()=>[h(O,{label:"男",value:"male"}),h(O,{label:"女",value:"female"}),h(O,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),h(K,{label:"部门",prop:"department"},{default:b(()=>[h(H,{modelValue:se.department,"onUpdate:modelValue":c[10]||(c[10]=e=>se.department=e),placeholder:"请输入所属部门",clearable:""},null,8,["modelValue"])]),_:1}),h(K,{label:"状态",prop:"is_active"},{default:b(()=>[h(ke,{modelValue:se.is_active,"onUpdate:modelValue":c[11]||(c[11]=e=>se.is_active=e)},{default:b(()=>[h(je,{label:!0},{default:b(()=>[...c[20]||(c[20]=[C("启用",-1)])]),_:1}),h(je,{label:!1},{default:b(()=>[...c[21]||(c[21]=[C("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-c269d6e4"]]);export{W as default};
