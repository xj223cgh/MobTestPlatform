/* empty css                  */import{E as e,a}from"./el-tab-pane-bfdb8e67.js";import{a as l,E as r}from"./el-input-89ea148f.js";import{E as s,a as o}from"./el-radio-group-56c94ad0.js";import{a as d,E as t}from"./el-col-538f99f5.js";import{E as n}from"./el-avatar-0aa28464.js";import{u,a as p,r as i,b as m,o as f,c,d as _,e as g,f as v,w,F as h,L as b,de as V,n as y,j,i as x,df as U,ao as C,k,l as z}from"./index-cd351671.js";import{a as E}from"./user-d427ae24.js";import{_ as q}from"./_plugin-vue_export-helper-1b428a4d.js";import"./raf-907dd12a.js";import"./strings-b003b1cc.js";import"./omit-7b0b3aa9.js";import"./castArray-824cd328.js";const B={class:"profile-container"},F={class:"profile-header"},O={class:"profile-avatar"},A={class:"avatar-text"},I={class:"role-text"},L={class:"profile-content card"},M={class:"info-section"},N={class:"form-actions"},P={class:"password-section"},R={class:"form-actions"},T=q({__name:"Profile",setup(q){const T=u(),$=p(),D=i("info"),J=i({}),K=i(),S=m({username:"",real_name:"",gender:"other",phone:"",department:""}),Z={real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]},G=i(),H=m({old_password:"",new_password:"",confirm_password:""}),Q={old_password:[{required:!0,message:"请输入原密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirm_password:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==H.new_password?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},W=i(!1),X=i(!1),Y=e=>({super:"超级管理员",manager:"管理员",tester:"测试员",admin:"实习生"}[e]||e),ee=e=>{if(!e)return"-";return new Date(e).toLocaleString("zh-CN")},ae=async()=>{try{const e=await V();200===e.code&&(J.value=e.data.user,S.username=J.value.username,S.real_name=J.value.real_name||"",S.gender=J.value.gender||"other",S.phone=J.value.phone||"",S.department=J.value.department||"")}catch(e){console.error("获取用户信息失败:",e),y.error("获取用户信息失败")}},le=async()=>{if(K.value)try{await K.value.validate(),W.value=!0;const e=await E(J.value.id,{real_name:S.real_name,gender:S.gender,phone:S.phone,department:S.department});200===e.code?($.updateUserInfo({real_name:S.real_name,gender:S.gender,phone:S.phone,department:S.department}),y.success("个人信息更新成功"),await ae()):y.error(e.message||"更新失败")}catch(e){console.error("更新个人信息失败:",e),y.error("更新失败，请稍后重试")}finally{W.value=!1}},re=()=>{S.real_name=J.value.real_name||"",S.gender=J.value.gender||"other",S.phone=J.value.phone||"",S.department=J.value.department||""},se=async()=>{var e,a;if(G.value)try{await G.value.validate(),X.value=!0;const e=await U({old_password:H.old_password,new_password:H.new_password});if(200===e.code){oe();try{await C.confirm("密码修改成功，为了安全起见，请重新登录","重新登录",{confirmButtonText:"去登录",cancelButtonText:"取消",type:"info",showCancelButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1})}catch(l){console.log("弹窗被关闭，但仍需登出")}await $.logout(),T.replace("/login")}else y.error(e.message||"密码修改失败")}catch(r){"MessageBoxCloseError"!==r.name&&(console.error("修改密码失败:",r),y.error((null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"密码修改失败，请稍后重试"))}finally{X.value=!1}},oe=()=>{var e;H.old_password="",H.new_password="",H.confirm_password="",null==(e=G.value)||e.clearValidate()};return f(()=>{ae()}),(u,p)=>{const i=n,m=k,f=l,V=d,y=t,U=s,C=o,E=z,q=r,T=a,$=e;return c(),_("div",B,[p[18]||(p[18]=g("div",{class:"page-header"},[g("h1",{class:"title"},"个人中心")],-1)),g("div",F,[g("div",O,[v(i,{size:80,src:J.value.avatar,class:h(u.avatar-u.gradient)},{default:w(()=>[j(b((J.value.username||"?").charAt(0).toUpperCase()),1)]),_:1},8,["src","class"]),g("div",A,[g("h2",null,b(J.value.username||"未知人员"),1),g("p",I,b(Y(J.value.role)),1)])])]),g("div",L,[v($,{modelValue:D.value,"onUpdate:modelValue":p[8]||(p[8]=e=>D.value=e),class:"profile-tabs"},{default:w(()=>[v(T,{label:"个人信息",name:"info"},{default:w(()=>[g("div",M,[p[14]||(p[14]=g("h3",{class:"section-title"},"基本信息",-1)),v(q,{ref_key:"infoFormRef",ref:K,model:S,rules:Z,"label-width":"120px",class:"info-form",size:"large"},{default:w(()=>[v(y,{gutter:20},{default:w(()=>[v(V,{span:12},{default:w(()=>[v(f,{label:"用户名",prop:"username"},{default:w(()=>[v(m,{modelValue:S.username,"onUpdate:modelValue":p[0]||(p[0]=e=>S.username=e),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),v(V,{span:12},{default:w(()=>[v(f,{label:"真实姓名",prop:"real_name"},{default:w(()=>[v(m,{modelValue:S.real_name,"onUpdate:modelValue":p[1]||(p[1]=e=>S.real_name=e),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,{gutter:20},{default:w(()=>[v(V,{span:12},{default:w(()=>[v(f,{label:"性别",prop:"gender"},{default:w(()=>[v(C,{modelValue:S.gender,"onUpdate:modelValue":p[2]||(p[2]=e=>S.gender=e)},{default:w(()=>[v(U,{value:"male"},{default:w(()=>[...p[9]||(p[9]=[j("男",-1)])]),_:1}),v(U,{value:"female"},{default:w(()=>[...p[10]||(p[10]=[j("女",-1)])]),_:1}),v(U,{value:"other"},{default:w(()=>[...p[11]||(p[11]=[j("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),v(V,{span:12},{default:w(()=>[v(f,{label:"手机号",prop:"phone"},{default:w(()=>[v(m,{modelValue:S.phone,"onUpdate:modelValue":p[3]||(p[3]=e=>S.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,null,{default:w(()=>[v(V,{span:24},{default:w(()=>[v(f,{label:"部门",prop:"department"},{default:w(()=>[v(m,{modelValue:S.department,"onUpdate:modelValue":p[4]||(p[4]=e=>S.department=e),placeholder:"请输入部门"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,{gutter:20},{default:w(()=>[v(V,{span:12},{default:w(()=>[v(f,{label:"角色"},{default:w(()=>[v(m,{value:Y(J.value.role),disabled:""},null,8,["value"])]),_:1})]),_:1}),v(V,{span:12},{default:w(()=>[v(f,{label:"创建时间"},{default:w(()=>[v(m,{value:ee(J.value.created_at),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),v(f,null,{default:w(()=>[g("div",N,[v(E,{type:"primary",loading:W.value,onClick:le,size:"large"},{default:w(()=>[...p[12]||(p[12]=[j(" 保存 ",-1)])]),_:1},8,["loading"]),v(E,{onClick:re,size:"large"},{default:w(()=>[...p[13]||(p[13]=[j("重置",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1}),v(T,{label:"修改密码",name:"password"},{default:w(()=>[g("div",P,[p[17]||(p[17]=g("h3",{class:"section-title"},"修改密码",-1)),v(q,{ref_key:"passwordFormRef",ref:G,model:H,rules:Q,"label-width":"120px",class:"password-form",size:"large"},{default:w(()=>[v(y,null,{default:w(()=>[v(V,{span:24},{default:w(()=>[v(f,{label:"原密码",prop:"old_password"},{default:w(()=>[v(m,{modelValue:H.old_password,"onUpdate:modelValue":p[5]||(p[5]=e=>H.old_password=e),type:"password",placeholder:"请输入原密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,null,{default:w(()=>[v(V,{span:24},{default:w(()=>[v(f,{label:"新密码",prop:"new_password"},{default:w(()=>[v(m,{modelValue:H.new_password,"onUpdate:modelValue":p[6]||(p[6]=e=>H.new_password=e),type:"password",placeholder:"请输入新密码（至少6位）","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,null,{default:w(()=>[v(V,{span:24},{default:w(()=>[v(f,{label:"确认密码",prop:"confirm_password"},{default:w(()=>[v(m,{modelValue:H.confirm_password,"onUpdate:modelValue":p[7]||(p[7]=e=>H.confirm_password=e),type:"password",placeholder:"请再次输入新密码","show-password":"",onKeyup:x(se,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(f,null,{default:w(()=>[g("div",R,[v(E,{type:"primary",loading:X.value,onClick:se,size:"large"},{default:w(()=>[...p[15]||(p[15]=[j(" 修改密码 ",-1)])]),_:1},8,["loading"]),v(E,{onClick:oe,size:"large"},{default:w(()=>[...p[16]||(p[16]=[j("重置",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-525e9dee"]]);export{T as default};
