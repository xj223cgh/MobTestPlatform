/* empty css                  *//* empty css                   */import{E as e}from"./el-overlay-71eaae9d.js";import{E as a,a as l}from"./el-radio-group-56c94ad0.js";import{E as r}from"./el-pagination-aa6134da.js";import{E as t}from"./el-tag-418c1d1c.js";import{a as s,E as o}from"./el-select-b829cea3.js";import"./el-scrollbar-0528a0c4.js";import{E as n,a as d}from"./el-input-89ea148f.js";import{E as u,a as i}from"./el-table-column-5340bcc8.js";import"./el-checkbox-14904d7f.js";import"./el-tooltip-4ed993c7.js";import{r as p,b as m,o as c,c as g,d as _,e as f,f as v,w as h,a5 as b,J as w,n as y,l as V,h as j,aB as k,j as C,i as x,aC as U,aD as z,L as q,aq as E,ao as $,E as B,k as D}from"./index-cd351671.js";import{g as I,d as T,t as Y,a as A,c as F}from"./user-d427ae24.js";import{d as K}from"./dayjs.min-fd58e32d.js";import{_ as M}from"./_plugin-vue_export-helper-1b428a4d.js";import{v as O}from"./directive-1c779a20.js";import"./refs-9112775b.js";import"./omit-7b0b3aa9.js";import"./strings-b003b1cc.js";import"./castArray-824cd328.js";import"./raf-907dd12a.js";const H={class:"user-management"},J={class:"page-header"},L={class:"header-actions"},S={class:"search-section"},N={class:"table-section"},P={key:1},R={key:1},Z={class:"operation-buttons"},G={class:"fixed-pagination"},Q={class:"dialog-footer"},W=M({__name:"UserManagement",setup(M){const W=p(!1),X=p(!1),ee=p(!1),ae=p(!1),le=p(""),re=p(),te=m({username:"",phone:"",role:"",status:""}),se=m({id:null,username:"",real_name:"",phone:"",password:"",role:"",is_active:!0,gender:"other",department:""}),oe={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],is_active:[{required:!0,message:"请选择状态",trigger:"change"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],department:[{max:100,message:"部门名称不能超过100个字符",trigger:"blur"}]},ne=p([]),de=m({page:1,size:10,total:0}),ue=async()=>{try{W.value=!0;const e={page:de.page,size:de.size};let a="";te.username?a=te.username:te.phone&&(a=te.phone),a&&(e.search=a),te.role&&(e.role=te.role),"true"!==te.status&&"false"!==te.status||(e.is_active="true"===te.status),console.log("API请求参数:",e);const l=await I(e);ne.value=l.data.users||[],de.total=l.data.pagination.total||0}catch(e){y.error("获取用户列表失败"),console.error("获取用户列表错误:",e)}finally{W.value=!1}},ie=()=>{de.page=1,ue()},pe=()=>{Object.assign(te,{username:"",phone:"",role:"",status:""}),ie()},me=()=>{ae.value=!1,le.value="新增用户",ee.value=!0,ge()},ce=async()=>{if(re.value){await re.value.validate(),X.value=!0;try{const e={username:se.username,real_name:se.real_name,phone:se.phone,role:se.role,is_active:se.is_active,gender:se.gender,department:se.department};let a;!ae.value&&se.password&&(e.password=se.password),a=ae.value?await A(se.id,e):await F(e),a.success?(y.success(ae.value?"编辑成功":"创建成功"),ee.value=!1,ue()):y.error(a.message||(ae.value?"编辑失败":"创建失败"))}catch(e){y.error("操作失败")}finally{X.value=!1}}},ge=()=>{Object.assign(se,{id:null,username:"",real_name:"",phone:"",password:"",role:"",is_active:!0,gender:"other",department:""}),re.value&&re.value.resetFields()},_e=e=>{de.size=e,de.page=1,ue()},fe=e=>{de.page=e,ue()},ve=e=>({super:"超级管理员",admin:"实习生",manager:"管理员",tester:"测试人员"}[e]||e);return c(()=>{ue()}),(p,m)=>{const c=B,I=V,A=D,F=d,M=s,ge=o,he=n,be=i,we=t,ye=u,Ve=r,je=a,ke=l,Ce=e,xe=O;return g(),_("div",H,[f("div",J,[m[15]||(m[15]=f("div",{class:"header-content"},[f("h1",null,"用户管理"),f("p",{class:"description"},"管理系统用户账号与权限")],-1)),f("div",L,[v(I,{type:"primary",onClick:me},{default:h(()=>[v(c,null,{default:h(()=>[v(j(k))]),_:1}),m[14]||(m[14]=C(" 新增用户 ",-1))]),_:1})])]),f("div",S,[v(he,{model:te,inline:""},{default:h(()=>[v(F,{label:"用户名/姓名"},{default:h(()=>[v(A,{modelValue:te.username,"onUpdate:modelValue":m[0]||(m[0]=e=>te.username=e),placeholder:"请输入用户名/姓名",clearable:"",onClear:ie,onKeyup:x(ie,["enter"]),style:{width:"150px"}},null,8,["modelValue"])]),_:1}),v(F,{label:"手机号"},{default:h(()=>[v(A,{modelValue:te.phone,"onUpdate:modelValue":m[1]||(m[1]=e=>te.phone=e),placeholder:"请输入手机号",clearable:"",onClear:ie,onKeyup:x(ie,["enter"]),style:{width:"150px"}},null,8,["modelValue"])]),_:1}),v(F,{label:"角色"},{default:h(()=>[v(ge,{modelValue:te.role,"onUpdate:modelValue":m[2]||(m[2]=e=>te.role=e),placeholder:"全部角色",clearable:"",onClear:ie,style:{width:"120px"}},{default:h(()=>[v(M,{label:"超级管理员",value:"super"}),v(M,{label:"管理员",value:"manager"}),v(M,{label:"测试人员",value:"tester"}),v(M,{label:"实习生",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),v(F,{label:"用户状态"},{default:h(()=>[v(ge,{modelValue:te.status,"onUpdate:modelValue":m[3]||(m[3]=e=>te.status=e),placeholder:"全部状态",clearable:"",onClear:ie,style:{width:"120px"}},{default:h(()=>[v(M,{label:"启用",value:"true"}),v(M,{label:"禁用",value:"false"})]),_:1},8,["modelValue"])]),_:1}),v(F,null,{default:h(()=>[v(I,{type:"primary",onClick:ie},{default:h(()=>[v(c,null,{default:h(()=>[v(j(U))]),_:1}),m[16]||(m[16]=C(" 搜索 ",-1))]),_:1}),v(I,{onClick:pe},{default:h(()=>[v(c,null,{default:h(()=>[v(j(z))]),_:1}),m[17]||(m[17]=C(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),f("div",N,[b((g(),w(ye,{data:ne.value,stripe:"",border:"",style:{width:"100%"},fit:""},{default:h(()=>[v(be,{prop:"id",label:"ID","min-width":"60",align:"center"},{default:h(({row:e})=>[C(q(e.id||"-"),1)]),_:1}),v(be,{prop:"username",label:"用户名","min-width":"110",align:"center"},{default:h(({row:e})=>[C(q(e.username||"-"),1)]),_:1}),v(be,{prop:"real_name",label:"真实姓名","min-width":"100",align:"center"},{default:h(({row:e})=>[C(q(e.real_name||"-"),1)]),_:1}),v(be,{prop:"phone",label:"手机号","min-width":"130",align:"center"},{default:h(({row:e})=>[C(q(e.phone||"-"),1)]),_:1}),v(be,{prop:"department",label:"部门","min-width":"110",align:"center"},{default:h(({row:e})=>[C(q(e.department||"-"),1)]),_:1}),v(be,{prop:"role",label:"角色","min-width":"90",align:"center"},{default:h(({row:e})=>{return[e.role?(g(),w(we,{key:0,type:(a=e.role,{super:"danger",admin:"info",manager:"warning",tester:"success"}[a]||"info")},{default:h(()=>[C(q(ve(e.role)),1)]),_:2},1032,["type"])):(g(),_("span",P,"-"))];var a}),_:1}),v(be,{prop:"is_active",label:"状态","min-width":"70",align:"center"},{default:h(({row:e})=>[void 0!==e.is_active?(g(),w(we,{key:0,type:e.is_active?"success":"danger"},{default:h(()=>[C(q(e.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])):(g(),_("span",R,"-"))]),_:1}),v(be,{prop:"created_at",label:"创建时间","min-width":"140",align:"center"},{default:h(({row:e})=>{return[C(q((a=e.created_at,a?K(a).format("YYYY-MM-DD HH:mm:ss"):"-")),1)];var a}),_:1}),v(be,{label:"操作","min-width":"180",fixed:"right",align:"center"},{default:h(({row:e})=>[f("div",Z,[v(I,{type:"primary",size:"small",onClick:a=>(e=>{ae.value=!0,le.value="编辑用户",ee.value=!0,Object.assign(se,{id:e.id,username:e.username,real_name:e.real_name,phone:e.phone,password:"",role:e.role,is_active:e.is_active,gender:e.gender||"other",department:e.department||""})})(e)},{default:h(()=>[...m[18]||(m[18]=[C(" 编辑 ",-1)])]),_:1},8,["onClick"]),v(I,{type:e.is_active?"warning":"success",size:"small",onClick:a=>(e=>{const a=e.is_active?"禁用":"启用";$.confirm(`确定要${a}用户 "${e.username}" 吗？`,`确认${a}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Y(e.id),y.success(`${a}成功`),ue()}catch(l){y.error(`${a}失败`)}})})(e)},{default:h(()=>[C(q(e.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),v(I,{type:"danger",size:"small",onClick:a=>(e=>{$.confirm(`确定要删除用户 "${e.username}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await T(e.id);a.success?(y.success("删除成功"),ue()):y.error(a.message||"删除失败")}catch(a){y.error("删除失败")}})})(e)},{default:h(()=>[...m[19]||(m[19]=[C(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[xe,W.value]])]),f("div",G,[v(Ve,{"current-page":de.page,"page-size":de.size,total:de.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_e,onCurrentChange:fe},null,8,["current-page","page-size","total"])]),v(Ce,{modelValue:ee.value,"onUpdate:modelValue":m[13]||(m[13]=e=>ee.value=e),title:le.value,width:"600px","close-on-click-modal":!1},{footer:h(()=>[f("span",Q,[v(I,{onClick:m[12]||(m[12]=e=>ee.value=!1)},{default:h(()=>[...m[22]||(m[22]=[C("取消",-1)])]),_:1}),v(I,{type:"primary",loading:X.value,onClick:ce},{default:h(()=>[...m[23]||(m[23]=[C(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:h(()=>[v(he,{ref_key:"userFormRef",ref:re,model:se,rules:oe,"label-width":"80px"},{default:h(()=>[v(F,{label:"用户名",prop:"username"},{default:h(()=>[v(A,{modelValue:se.username,"onUpdate:modelValue":m[4]||(m[4]=e=>se.username=e),placeholder:"请输入用户名",disabled:ae.value},null,8,["modelValue","disabled"])]),_:1}),v(F,{label:"真实姓名",prop:"real_name"},{default:h(()=>[v(A,{modelValue:se.real_name,"onUpdate:modelValue":m[5]||(m[5]=e=>se.real_name=e),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),v(F,{label:"手机号",prop:"phone"},{default:h(()=>[v(A,{modelValue:se.phone,"onUpdate:modelValue":m[6]||(m[6]=e=>se.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),ae.value?E("",!0):(g(),w(F,{key:0,label:"密码",prop:"password"},{default:h(()=>[v(A,{modelValue:se.password,"onUpdate:modelValue":m[7]||(m[7]=e=>se.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),v(F,{label:"角色",prop:"role"},{default:h(()=>[v(ge,{modelValue:se.role,"onUpdate:modelValue":m[8]||(m[8]=e=>se.role=e),placeholder:"请选择角色",style:{width:"100%"}},{default:h(()=>[v(M,{label:"超级管理员",value:"super"}),v(M,{label:"管理员",value:"manager"}),v(M,{label:"测试人员",value:"tester"}),v(M,{label:"实习生",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),v(F,{label:"性别",prop:"gender"},{default:h(()=>[v(ge,{modelValue:se.gender,"onUpdate:modelValue":m[9]||(m[9]=e=>se.gender=e),placeholder:"请选择性别",style:{width:"100%"}},{default:h(()=>[v(M,{label:"男",value:"male"}),v(M,{label:"女",value:"female"}),v(M,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),v(F,{label:"部门",prop:"department"},{default:h(()=>[v(A,{modelValue:se.department,"onUpdate:modelValue":m[10]||(m[10]=e=>se.department=e),placeholder:"请输入所属部门",clearable:""},null,8,["modelValue"])]),_:1}),v(F,{label:"状态",prop:"is_active"},{default:h(()=>[v(ke,{modelValue:se.is_active,"onUpdate:modelValue":m[11]||(m[11]=e=>se.is_active=e)},{default:h(()=>[v(je,{label:!0},{default:h(()=>[...m[20]||(m[20]=[C("启用",-1)])]),_:1}),v(je,{label:!1},{default:h(()=>[...m[21]||(m[21]=[C("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-a6b8654d"]]);export{W as default};
