/* empty css                  */import{E as e,a}from"./el-tab-pane-af682d02.js";import{a as l,E as r}from"./el-input-320f57dc.js";import{E as s,a as o}from"./el-radio-group-e12b1858.js";import{E as d,a as t}from"./el-col-ede98d7c.js";import{E as n}from"./el-avatar-a7804f43.js";import{u,a as p,r as i,b as m,o as f,c,d as _,e as g,f as v,w,F as h,L as b,de as V,n as y,j,i as U,df as x,ao as C,k,l as z}from"./index-ea26c5b6.js";import{a as E}from"./user-e232a6b8.js";import{_ as q}from"./_plugin-vue_export-helper-1b428a4d.js";import"./raf-45c3df72.js";import"./strings-836bc6fd.js";import"./omit-2fc30497.js";import"./castArray-7303869c.js";const B={class:"profile-container"},F={class:"profile-header"},L={class:"profile-avatar"},A={class:"avatar-text"},I={class:"role-text"},K={class:"profile-content card"},M={class:"info-section"},O={class:"form-actions"},P={class:"password-section"},R={class:"form-actions"},T=q({__name:"Profile",setup(q){const T=u(),D=p(),H=i("info"),N=i({}),S=i(),X=m({username:"",real_name:"",gender:"other",phone:"",department:""}),$={real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]},G=i(),J=m({old_password:"",new_password:"",confirm_password:""}),Q={old_password:[{required:!0,message:"请输入原密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirm_password:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==J.new_password?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},W=i(!1),Y=i(!1),Z=e=>({super:"超级管理员",manager:"管理员",tester:"测试员",admin:"实习生"}[e]||e),ee=e=>{if(!e)return"-";return new Date(e).toLocaleString("zh-CN")},ae=async()=>{try{const e=await V();200===e.code&&(N.value=e.data.user,X.username=N.value.username,X.real_name=N.value.real_name||"",X.gender=N.value.gender||"other",X.phone=N.value.phone||"",X.department=N.value.department||"")}catch(e){console.error("获取用户信息失败:",e),y.error("获取用户信息失败")}},le=async()=>{if(S.value)try{await S.value.validate(),W.value=!0;const e=await E(N.value.id,{real_name:X.real_name,gender:X.gender,phone:X.phone,department:X.department});200===e.code?(D.updateUserInfo({real_name:X.real_name,gender:X.gender,phone:X.phone,department:X.department}),y.success("个人信息更新成功"),await ae()):y.error(e.message||"更新失败")}catch(e){console.error("更新个人信息失败:",e),y.error("更新失败，请稍后重试")}finally{W.value=!1}},re=()=>{X.real_name=N.value.real_name||"",X.gender=N.value.gender||"other",X.phone=N.value.phone||"",X.department=N.value.department||""},se=async()=>{var e,a;if(G.value)try{await G.value.validate(),Y.value=!0;const e=await x({old_password:J.old_password,new_password:J.new_password});if(200===e.code){oe();try{await C.confirm("密码修改成功，为了安全起见，请重新登录","重新登录",{confirmButtonText:"去登录",cancelButtonText:"取消",type:"info",showCancelButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1})}catch(l){console.log("弹窗被关闭，但仍需登出")}await D.logout(),T.replace("/login")}else y.error(e.message||"密码修改失败")}catch(r){"MessageBoxCloseError"!==r.name&&(console.error("修改密码失败:",r),y.error((null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"密码修改失败，请稍后重试"))}finally{Y.value=!1}},oe=()=>{var e;J.old_password="",J.new_password="",J.confirm_password="",null==(e=G.value)||e.clearValidate()};return f(()=>{ae()}),(u,p)=>{const i=n,m=k,f=l,V=d,y=t,x=s,C=o,E=z,q=r,T=a,D=e;return c(),_("div",B,[p[18]||(p[18]=g("div",{class:"page-header"},[g("h1",{class:"title"},"个人中心")],-1)),g("div",F,[g("div",L,[v(i,{size:80,src:N.value.avatar,class:h(u.avatar-u.gradient)},{default:w(()=>[j(b((N.value.username||"?").charAt(0).toUpperCase()),1)]),_:1},8,["src","class"]),g("div",A,[g("h2",null,b(N.value.username||"未知人员"),1),g("p",I,b(Z(N.value.role)),1)])])]),g("div",K,[v(D,{modelValue:H.value,"onUpdate:modelValue":p[8]||(p[8]=e=>H.value=e),class:"profile-tabs"},{default:w(()=>[v(T,{label:"个人信息",name:"info"},{default:w(()=>[g("div",M,[p[14]||(p[14]=g("h3",{class:"section-title"},"基本信息",-1)),v(q,{ref_key:"infoFormRef",ref:S,model:X,rules:$,"label-width":"120px",class:"info-form",size:"large"},{default:w(()=>[v(y,{gutter:20},{default:w(()=>[v(V,{span:12},{default:w(()=>[v(f,{label:"用户名",prop:"username"},{default:w(()=>[v(m,{modelValue:X.username,"onUpdate:modelValue":p[0]||(p[0]=e=>X.username=e),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),v(V,{span:12},{default:w(()=>[v(f,{label:"真实姓名",prop:"real_name"},{default:w(()=>[v(m,{modelValue:X.real_name,"onUpdate:modelValue":p[1]||(p[1]=e=>X.real_name=e),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,{gutter:20},{default:w(()=>[v(V,{span:12},{default:w(()=>[v(f,{label:"性别",prop:"gender"},{default:w(()=>[v(C,{modelValue:X.gender,"onUpdate:modelValue":p[2]||(p[2]=e=>X.gender=e)},{default:w(()=>[v(x,{value:"male"},{default:w(()=>[...p[9]||(p[9]=[j("男",-1)])]),_:1}),v(x,{value:"female"},{default:w(()=>[...p[10]||(p[10]=[j("女",-1)])]),_:1}),v(x,{value:"other"},{default:w(()=>[...p[11]||(p[11]=[j("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),v(V,{span:12},{default:w(()=>[v(f,{label:"手机号",prop:"phone"},{default:w(()=>[v(m,{modelValue:X.phone,"onUpdate:modelValue":p[3]||(p[3]=e=>X.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,null,{default:w(()=>[v(V,{span:24},{default:w(()=>[v(f,{label:"部门",prop:"department"},{default:w(()=>[v(m,{modelValue:X.department,"onUpdate:modelValue":p[4]||(p[4]=e=>X.department=e),placeholder:"请输入部门"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,{gutter:20},{default:w(()=>[v(V,{span:12},{default:w(()=>[v(f,{label:"角色"},{default:w(()=>[v(m,{value:Z(N.value.role),disabled:""},null,8,["value"])]),_:1})]),_:1}),v(V,{span:12},{default:w(()=>[v(f,{label:"创建时间"},{default:w(()=>[v(m,{value:ee(N.value.created_at),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),v(f,null,{default:w(()=>[g("div",O,[v(E,{type:"primary",loading:W.value,onClick:le,size:"large"},{default:w(()=>[...p[12]||(p[12]=[j(" 保存 ",-1)])]),_:1},8,["loading"]),v(E,{onClick:re,size:"large"},{default:w(()=>[...p[13]||(p[13]=[j("重置",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1}),v(T,{label:"修改密码",name:"password"},{default:w(()=>[g("div",P,[p[17]||(p[17]=g("h3",{class:"section-title"},"修改密码",-1)),v(q,{ref_key:"passwordFormRef",ref:G,model:J,rules:Q,"label-width":"120px",class:"password-form",size:"large"},{default:w(()=>[v(y,null,{default:w(()=>[v(V,{span:24},{default:w(()=>[v(f,{label:"原密码",prop:"old_password"},{default:w(()=>[v(m,{modelValue:J.old_password,"onUpdate:modelValue":p[5]||(p[5]=e=>J.old_password=e),type:"password",placeholder:"请输入原密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,null,{default:w(()=>[v(V,{span:24},{default:w(()=>[v(f,{label:"新密码",prop:"new_password"},{default:w(()=>[v(m,{modelValue:J.new_password,"onUpdate:modelValue":p[6]||(p[6]=e=>J.new_password=e),type:"password",placeholder:"请输入新密码（至少6位）","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(y,null,{default:w(()=>[v(V,{span:24},{default:w(()=>[v(f,{label:"确认密码",prop:"confirm_password"},{default:w(()=>[v(m,{modelValue:J.confirm_password,"onUpdate:modelValue":p[7]||(p[7]=e=>J.confirm_password=e),type:"password",placeholder:"请再次输入新密码","show-password":"",onKeyup:U(se,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),v(f,null,{default:w(()=>[g("div",R,[v(E,{type:"primary",loading:Y.value,onClick:se,size:"large"},{default:w(()=>[...p[15]||(p[15]=[j(" 修改密码 ",-1)])]),_:1},8,["loading"]),v(E,{onClick:oe,size:"large"},{default:w(()=>[...p[16]||(p[16]=[j("重置",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-525e9dee"]]);export{T as default};
